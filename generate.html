<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>NEW FRECNO GENERATOR</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }

    label {
      display: block;
      margin-bottom: 6px;
      font-weight: bold;
    }

    button {
      padding: 10px 20px;
      margin-right: 10px;
      margin-top: 10px;
    }

    pre {
      background-color: #d1a6a6;
      padding: 20px;
      margin: 10px 0;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    #startRecno {
      width: 50%;
      padding: 12px;
      margin: 10px 0;
      font-family: monospace;
      background-color: #f0f8ff;
      border: 2px solid #007acc;
      border-radius: 4px;
      font-size: 16px;
    }

    #oldRecnos {
      width: 100%;
      height: 150px;
      padding: 10px;
      margin: 15px 0;
      font-family: monospace;
      background-color: #fff8dc;
      border: 2px solid #d1a6a6;
      border-radius: 6px;
      font-size: 14px;
      resize: vertical;
    }
  </style>
</head>
<body>

<h2>NEW FRECNO GENERATOR</h2>

<label for="startRecno">ari e input ang latest frecno (THEN):</label>
<input type="number" id="startRecno" value="1000" />

<label for="oldRecnos">e paste ari ang old recno (one per line; e by column pag butang sa frecno dong):</label>
<textarea id="oldRecnos" placeholder="e.g.&#10;193742&#10;193743&#10;193744"></textarea>

<button onclick="generateSQL()">Generate SQL script</button>
<button onclick="clearForm()">Clear</button>
<button onclick="generateFtransmitReset()">generate the ftransmit=&quot;0000&quot; script</button>

<h3>generated SQL with new latest recno:</h3>
<button onclick="copySQL()">Copy to Clipboard</button>
<pre id="outputSQL"></pre>

<script>
  function generateSQL() {
    const startVal = parseInt(document.getElementById('startRecno').value);
    const oldText = document.getElementById('oldRecnos').value.trim();
    const oldLines = oldText.split(/\r?\n/).map(line => line.trim()).filter(line => line);

    const tables = ['pos_sale', 'pos_sale_payment', 'pos_sale_product'];
    let currentNew = startVal;

    const mappings = oldLines.map(oldVal => {
      const pair = { oldVal, newVal: currentNew };
      currentNew++;
      return pair;
    });

    const fullSQL = tables.map(table => {
      let sql = `UPDATE ${table}\nSET frecno = \n  CASE frecno\n`;
      mappings.forEach(({ oldVal, newVal }) => {
        sql += `    WHEN '${oldVal}' THEN '${newVal}'\n`;
      }); 
      sql += `    ELSE frecno\n  END;`;
      return sql;
    }).join('\n\n');

    document.getElementById('outputSQL').textContent = fullSQL;
  }

  function clearForm() {
    document.getElementById('startRecno').value = 1000;
    document.getElementById('oldRecnos').value = '';
    document.getElementById('outputSQL').textContent = '';
  }

  function copySQL() {
    const output = document.getElementById('outputSQL').textContent;
    if (!output) {
      alert('Nothing to copy! Please generate SQL first. Kiat lang nawng nimo da!');
      return;
    }
    navigator.clipboard.writeText(output).then(() => {
      alert('SQL script copied to clipboard! tinapolan style ba!');
    }).catch(() => {
      alert('Failed to copy. Please try manually.');
    });
  }

  function generateFtransmitReset() {
    const sql = `update pos_sale set ftransmit="0000";\n` +
                `update pos_sale_payment set ftransmit="0000";\n` +
                `update pos_sale_product set ftransmit="0000";`;
    document.getElementById('outputSQL').textContent = sql;
  }
</script>

</body>
</html>
