<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>New FRECNO Generator</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f7f9fc;
      padding: 40px 20px;
      max-width: 800px;
      margin: auto;
      color: #333;
    }

    h2, h3 {
      text-align: center;
      color: #1e90ff;
      margin-bottom: 30px;
    }

    label {
      display: block;
      font-weight: 600;
      margin: 20px 0 6px;
    }

    input[type="number"],
    textarea {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      border-radius: 6px;
      border: 1px solid #ccc;
      background-color: #fff;
      box-sizing: border-box;
    }

    textarea {
      height: 120px;
      resize: vertical;
    }

    button {
      padding: 10px 20px;
      margin: 10px 5px 20px 0;
      border: none;
      border-radius: 6px;
      font-size: 15px;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    button:hover { opacity: 0.9; }
    button:active { transform: scale(0.98); }

    .primary { background-color: #1e90ff; color: white; }
    .danger { background-color: #ff4d4d; color: white; }
    .secondary { background-color: #ffa500; color: white; }
    .copy { background-color: #4caf50; color: white; margin-bottom: 20px; }

    pre {
      background-color: #fff;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 6px;
      white-space: pre-wrap;
      word-wrap: break-word;
      font-family: 'Courier New', Courier, monospace;
      font-size: 15px;
    }
  </style>
</head>
<body>

  <h2>üîß New FRECNO Generator</h2>

  <label for="startRecno">Latest FRECNO (start point):</label>
  <input type="number" id="startRecno" value=""/>

  <label for="oldRecnos">Paste old FRECNO values (one per line):</label>
  <textarea id="oldRecnos" placeholder="e.g.&#10;193742&#10;193743&#10;193744"></textarea>

  <div>
    <button class="primary" onclick="generateSQL()">Generate SQL</button>
    <button class="danger" onclick="clearForm()">Clear</button>
    <button class="secondary" onclick="generateFtransmitReset()">Ftransmit Reset Script</button>
  </div>

  <h3>üìù Generated SQL:</h3>
  <button class="copy" onclick="copySQL()">Copy to Clipboard</button>

  <pre id="outputSQL">/* Output will appear here after generation */</pre>

  <script>
    function generateSQL() {
      const startVal = parseInt(document.getElementById('startRecno').value);
      const oldText = document.getElementById('oldRecnos').value.trim();

      if (!startVal || !oldText) {
        alert("Please enter both the latest FRECNO and at least one old FRECNO.");
        return;
      }

      const oldLines = oldText.split(/\r?\n/).map(line => line.trim()).filter(Boolean);
      const tables = ['pos_sale', 'pos_sale_payment', 'pos_sale_product'];
      let currentNew = startVal;

      const mappings = oldLines.map(oldVal => ({
        oldVal,
        newVal: currentNew++
      }));

      const fullSQL = tables.map(table => {
        let sql = `UPDATE ${table}\nSET frecno = \n  CASE frecno\n`;
        mappings.forEach(({ oldVal, newVal }) => {
          sql += `    WHEN '${oldVal}' THEN '${newVal}'\n`;
        });
        sql += `    ELSE frecno\n  END;`;
        return sql;
      }).join('\n\n');

      document.getElementById('outputSQL').textContent = fullSQL;
    }

    function generateFtransmitReset() {
      const sql = `UPDATE pos_sale SET ftransmit='0000';\n` +
                  `UPDATE pos_sale_payment SET ftransmit='0000';\n` +
                  `UPDATE pos_sale_product SET ftransmit='0000';`;
      document.getElementById('outputSQL').textContent = sql;
    }

    function clearForm() {
      document.getElementById('startRecno').value = '';
      document.getElementById('oldRecnos').value = '';
      document.getElementById('outputSQL').textContent = '/* Output will appear here after generation */';
    }

    function copySQL() {
      const output = document.getElementById('outputSQL').textContent;
      if (!output || output.includes("Output will appear")) {
        alert('Nothing to copy. Please generate SQL first.');
        return;
      }

      navigator.clipboard.writeText(output)
        .then(() => alert('‚úÖ SQL script copied to clipboard!'))
        .catch(() => alert('‚ùå Copy failed. Try manually.'));
    }
  </script>

</body>
</html>
